\begin{algorithm}[t]
\DontPrintSemicolon
\SetAlgoLined
\caption{Leave-One-Out Cross-Validation}
\label{algorithm: loocv}

1.\quad Choose panel dataset 
$\mathcal{D}=\{(y_{it},x_{it})\}$ 
where $i$ indexes firms, $t$ indexes years, 
$y_{it}$ denotes emissions and $x_{it}$ covariates. 
Choose model specifications $\{M_1,\dots,M_K\}$ and let $\mathcal{F}$ be the set of firms. 
Let $\mathbf{y}$ be the vector of observed emissions, with mean $\bar{y}$ and standard deviation $s_y$.\;

\BlankLine

2.\quad \tcp{Main LOO loop}
\ForEach{firm $i\in\mathcal{F}$}{
    Define training data 
    $\mathcal{D}^{(-i)}=\{(y_{jt},x_{jt}): j\neq i\}$ 
    and test data 
    $\mathcal{D}^{(i)}=\{(y_{it},x_{it})\}$.\;

    \For{$k=1$ \KwTo $K$}{
        Estimate parameters $\hat{\theta}^{(k,-i)}$ of model $M_k$ on $\mathcal{D}^{(-i)}$.\;

        \ForEach{$(y_{it},x_{it})\in\mathcal{D}^{(i)}$}{
            Compute prediction 
            $\hat{y}_{it}^{(k)} = f(x_{it};\hat{\theta}^{(k,-i)})$ 
            and store it in $\hat{\mathbf{y}}^{(k)}$.\;
        }
    }
}

\BlankLine

3.\quad \tcp{Compute performance metrics for each model}
\For{$k=1$ \KwTo $K$}{
    Compute squared errors 
    $e_{n}^{2,(k)}=(\hat{y}_{n}^{(k)}-y_n)^2$ 
    and absolute errors 
    $|e_{n}^{(k)}|=|\hat{y}_{n}^{(k)}-y_n|$.\;

    \tcp{Normalized RMSE}
    $\mathrm{RMSE}^{(k)}=\sqrt{\tfrac{1}{N}\sum_{n}e_{n}^{2,(k)}}$;\qquad
    $\mathrm{nRMSE}^{(k)}=\mathrm{RMSE}^{(k)}/s_y$.\;

    \tcp{MAPD}
    $\mathrm{MAPD}^{(k)}=
    \tfrac{1}{N}\sum_{n}\left|\tfrac{\hat{y}_{n}^{(k)}-y_n}{y_n}\right|$.\;

    \tcp{LOO $R^2$}
    $\mathrm{SSE}^{(k)}=\sum_{n}e_{n}^{2,(k)}$;\quad
    $\mathrm{SST}=\sum_{n}(y_n-\bar{y})^2$;\;
    $R^2_{\mathrm{LOO}}{}^{(k)}=
    1-\mathrm{SSE}^{(k)}/\mathrm{SST}$.\;

    \tcp{Spearman rank correlation}
    Compute $\rho^{(k)} = \mathrm{Spearman}(\mathbf{y},\hat{\mathbf{y}}^{(k)})$.\;
}
\end{algorithm}